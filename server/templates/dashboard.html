<!DOCTYPE html>
<html>
<head>
  <title>Driver Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    img.snapshot { width: 100px; height: auto; border-radius: 8px; }
    .info-box {
      padding: 15px;
      background: #f0fdf9;
      border-left: 5px solid #00e0b8;
      border-radius: 6px;
      margin-top: 10px;
      color: #065f46;
      font-size: 15px;
    }
  </style>
</head>

<body>
<header>
  <h1>Welcome, {{ name }}</h1>
  <p>Your Driver ID: <strong>{{ session['driver_id'] }}</strong></p>
  <nav>
    <a href="{{ url_for('passenger') }}">Passenger View</a>
    <a class="danger" href="{{ url_for('logout') }}">Logout</a>
  </nav>
</header>

<div class="grid">

  <!-- Safety Score -->
  <div class="tile">
    <h2>Safety Score</h2>
    <div class="score">{{ safety }}%</div>
    <p>Total Alerts: {{ total_events }} | Weighted (last 30 days): {{ weighted_events }}</p>
    <p class="hint">Recent alerts have more impact. Older alerts fade over time.</p>
  </div>

  <!-- Detection Info -->
  <div class="tile" style="border:2px solid #00e0b8;">
    <h2>Drowsiness Detection</h2>

    <div class="info-box">
      <strong>How detection works:</strong><br><br>
      Real-time drowsiness detection runs <b>locally on the driverâ€™s device</b>
      to access the camera and audio hardware.<br><br>

      This dashboard automatically displays safety alerts and reports
      received from the detection system.
    </div>

    <p class="hint" style="margin-top:10px;">
      To start detection, run the detection program on your local system.
    </p>
  </div>

</div>

<!-- Recent Events -->
<h2>Recent Events</h2>
<table>
  <tr>
    <th>Type</th>
    <th>Time</th>
    <th>Snapshot</th>
  </tr>

  {% for e in events %}
  <tr>
    <td>{{ e['event_type'] }}</td>
    <td>{{ e['ts'] }}</td>
    <td>
      {% if e['image_path'] %}
        <a href="/{{ e['image_path'] }}" target="_blank">
          <img class="snapshot" src="/{{ e['image_path'] }}" alt="snapshot">
        </a>
      {% else %}
        -
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>

</body>
</html>
